<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Instagram - Dezembro</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        h1 {
            text-align: center;
        }
        .filters {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
        }
        select, button {
            padding: 10px;
            font-size: 16px;
        }
        .kpis {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        table {
            width: 100%;
            background: white;
            border-collapse: collapse;
            margin-top: 30px;
        }
        table th, table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background: #333;
            color: white;
        }
    </style>
</head>
<body>

<h1>Dashboard Instagram - Dezembro</h1>

<div class="filters">
    <select id="unitFilter"></select>
    <button onclick="loadData()">Atualizar</button>
</div>

<div class="kpis">
    <div class="card" id="kpiDirects">Directs: 0</div>
    <div class="card" id="kpiRespostas">Respostas: 0</div>
    <div class="card" id="kpiAgendamentos">Agendamentos: 0</div>
    <div class="card" id="kpiComparecimentos">Comparecimentos: 0</div>
    <div class="card" id="kpiVendas">Vendas: 0</div>
    <div class="card" id="kpiConversao">Conversão Final: 0%</div>
</div>

<h2>Resumo por Unidade</h2>
<table id="resultTable">
    <thead>
        <tr>
            <th>Unidade</th>
            <th>Directs</th>
            <th>Respostas</th>
            <th>Agendamentos</th>
            <th>Comparecimentos</th>
            <th>Vendas</th>
            <th>Conversão (%)</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>

// CSV oficial enviado:
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSjDEbxS9ieNObM4lVDYcZ_E9tzuDvf92I8e0VEJCrkByw2r9gHUiUsWWGkE65J97dkiO0Ind8GEoju/pub?gid=308040371&single=true&output=csv";

let rawData = [];

async function loadData() {
    const response = await fetch(CSV_URL);
    const csvText = await response.text();
    const lines = csvText.split("\n").map(l => l.split(","));

    const headers = lines[0];
    const rows = lines.slice(1).filter(r => r[0].trim() !== "");

    rawData = rows.map(r => ({
        unidade: r[0],
        directs: Number(r[1]),
        respostas: Number(r[2]),
        agendamentos: Number(r[3]),
        comparecimentos: Number(r[4]),
        vendas: Number(r[5])
    }));

    updateUnitFilter();
    updateDashboard();
}

function updateUnitFilter() {
    const select = document.getElementById("unitFilter");

    if (select.options.length === 0) {
        select.innerHTML = `<option value="TODAS">Todas Unidades</option>`;
        rawData.forEach(row => {
            const opt = document.createElement("option");
            opt.value = row.unidade;
            opt.innerText = row.unidade;
            select.appendChild(opt);
        });
    }
}

function updateDashboard() {
    const selected = document.getElementById("unitFilter").value;

    const data = selected === "TODAS"
        ? rawData
        : rawData.filter(r => r.unidade === selected);

    const totals = {
        directs: data.reduce((a,b) => a + b.directs, 0),
        respostas: data.reduce((a,b) => a + b.respostas, 0),
        agendamentos: data.reduce((a,b) => a + b.agendamentos, 0),
        comparecimentos: data.reduce((a,b) => a + b.comparecimentos, 0),
        vendas: data.reduce((a,b) => a + b.vendas, 0)
    };

    document.getElementById("kpiDirects").innerText = `Directs: ${totals.directs}`;
    document.getElementById("kpiRespostas").innerText = `Respostas: ${totals.respostas}`;
    document.getElementById("kpiAgendamentos").innerText = `Agendamentos: ${totals.agendamentos}`;
    document.getElementById("kpiComparecimentos").innerText = `Comparecimentos: ${totals.comparecimentos}`;
    document.getElementById("kpiVendas").innerText = `Vendas: ${totals.vendas}`;

    const conversao = totals.directs > 0 ? ((totals.vendas / totals.directs) * 100).toFixed(1) : "0";
    document.getElementById("kpiConversao").innerText = `Conversão Final: ${conversao}%`;

    const tbody = document.querySelector("#resultTable tbody");
    tbody.innerHTML = "";

    rawData.forEach(r => {
        if (selected !== "TODAS" && r.unidade !== selected) return;

        const conv = r.directs > 0 ? ((r.vendas / r.directs) * 100).toFixed(1) : 0;

        tbody.innerHTML += `
            <tr>
                <td>${r.unidade}</td>
                <td>${r.directs}</td>
                <td>${r.respostas}</td>
                <td>${r.agendamentos}</td>
                <td>${r.comparecimentos}</td>
                <td>${r.vendas}</td>
                <td>${conv}%</td>
            </tr>
        `;
    });
}

loadData();

</script>
</body>
</html>
